---
id: music.song-created
name: Song Created Events
version: 1.0.0
summary: |
  Routed via the `music.events` exchange whenever the Music Service inserts a new song. Consumers kick off enrichment pipelines from here.
owners:
  - tassosgomes
address: music.song-created
protocols:
  - amqp
schemaPath: ../../specs/music-service/asyncapi.yaml
publishers:
  - id: MusicService
    name: Music Service
subscribers:
  - id: VideoEnricher
    name: Video Enricher
messages:
  - collection: events
    name: Song Created Event
    id: SongCreatedEvent
    version: 1.0.0
---

## Overview

- Exchange: `music.events`
- Routing Key: `song.created`
- Queue example: `music.song-created`

The payload matches the schema generated by SpringWolf. See the [AsyncAPI snapshot](../../../specs/music-service/asyncapi.yaml) for bindings and headers.

## Publishing Example (Spring)

```java
var event = SongCreatedEvent.builder()
    .songId(song.getId())
    .title(song.getTitle())
    .artist(song.getArtist())
    .genre(song.getGenre())
    .releaseDate(song.getReleaseDate())
    .build();

rabbitTemplate.convertAndSend(exchange, routingKey, event);
```

## Consuming Example (C#)

```csharp
public class SongCreatedConsumer : BackgroundService
{
    private readonly IRabbitMqConsumerService _consumer;

    protected override Task ExecuteAsync(CancellationToken stoppingToken)
    {
        return _consumer.ConsumeAsync("music.song-created", async message =>
        {
            var song = JsonSerializer.Deserialize<SongCreatedEvent>(message);
            await _scraper.HandleAsync(song);
        }, stoppingToken);
    }
}
```

## Payload highlights

| Field | Type | Notes |
| --- | --- | --- |
| `songId` | UUID | Correlates enrichment responses |
| `title` | string | Comes directly from the REST payload |
| `artist` | string | Mandatory |
| `releaseDate` | date | Optional ISO-8601 date |
| `genre` | string | Optional, defaults to `unknown` |
